---
- include_tasks: arch-aur.yml
  loop:
    - name: librewolf-bin
      deps:
        [
          gtk3,
          libxt,
          startup-notification,
          mime-types,
          dbus-glib,
          nss,
          ttf-font,
          libpulse,
          ffmpeg,
        ]
      gpg_key: 031F7104E932F7BD7416E7F6D2845E1305D6E801
      gpg_server: hkp://keyserver.ubuntu.com:80
  loop_control:
    loop_var: aur_item
  when: ansible_os_family == 'Archlinux'

- name: librewolf > importing apt-repo
  become: true
  block:
    - name: librewolf | apt key
      ansible.builtin.shell: |
        [ -f /etc/apt/trusted.gpg.d/librewolf.gpg ] \
          && rm /etc/apt/trusted.gpg.d/librewolf.gpg

        wget -O- https://deb.librewolf.net/keyring.gpg | gpg --dearmor -o /etc/apt/trusted.gpg.d/librewolf.gpg

    - name: librewolf | apt source
      ansible.builtin.apt_repository:
        repo: deb [arch=amd64 signed-by=/etc/apt/trusted.gpg.d/librewolf.gpg] https://deb.librewolf.net {{ ansible_distribution_release }} main
        filename: librewolf
        update_cache: yes
  when: ansible_os_family == 'Debian'

- name: librewolf > for Gentoo
  become: true
  block:
    - name: LibreWolf Repo
      ansible.builtin.copy:
        src: librewolf.conf
        dest: /etc/portage/repos.conf/librewolf.conf

    - name: LibreWolf Sync
      ansible.builtin.command: emaint -r librewolf sync
  when: ansible_os_family == 'Gentoo'

# https://github.com/index-0/librewolf-void/tree/master
- name: librewolf > for Void
  become: true
  block:
    - name: Adding LibreWolf Repo...
      ansible.builtin.copy:
        src: 20-librewolf.conf
        dest: /etc/xbps.d/20-librewolf.conf

    - name: Adding public key...
      ansible.builtin.lineinfile:
        src: "8f:d6:6b:76:ff:3c:31:95:60:2d:34:6e:83:29:89:13.plist"
        path: /var/db/xbps/keys/
  when: ansible_os_family == 'Void'

- name: librewolf > installing dependencies
  become: true
  ansible.builtin.package:
    name: "{{ web_browser_librewolf_pkg }}"
    state: present
  when: web_browser_librewolf_pkg is defined
